<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é£Ÿäº‹è¨˜éŒ² - æœ€å¼·ã®æ „é¤Šç®¡ç†å¸«AI</title>
    <link rel="stylesheet" href="/styles/index.css" />
    <link rel="stylesheet" href="/styles/theme.css" />
    <link
        href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet" />
</head>

<body>
    <header class="header">
        <h1>é£Ÿäº‹è¨˜éŒ²</h1>
        <nav class="nav">
            <a href="/">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
            <a href="/log.html" class="active">é£Ÿäº‹è¨˜éŒ²</a>
        </nav>
    </header>

    <main class="main">
        <!-- Input Section -->
        <section class="card animate-fade-in">
            <h2 class="mb-2">ğŸ“¸ ä½•ã‚’é£Ÿã¹ã¾ã—ãŸã‹ï¼Ÿ</h2>
            <form id="mealForm">
                <!-- Meal Type Selection -->
                <div class="form-group mb-2">
                    <label class="label mb-1">é£Ÿäº‹ã‚¿ã‚¤ãƒ— <span class="text-danger">*</span></label>
                    <div class="meal-type-buttons">
                        <button type="button" class="meal-type-btn" data-type="breakfast">
                            <span class="meal-type-icon">ğŸŒ…</span>
                            <span class="meal-type-label">æœé£Ÿ</span>
                        </button>
                        <button type="button" class="meal-type-btn" data-type="lunch">
                            <span class="meal-type-icon">â˜€ï¸</span>
                            <span class="meal-type-label">æ˜¼é£Ÿ</span>
                        </button>
                        <button type="button" class="meal-type-btn" data-type="dinner">
                            <span class="meal-type-icon">ğŸŒ™</span>
                            <span class="meal-type-label">å¤•é£Ÿ</span>
                        </button>
                        <button type="button" class="meal-type-btn" data-type="snack">
                            <span class="meal-type-icon">ğŸª</span>
                            <span class="meal-type-label">é–“é£Ÿ</span>
                        </button>
                    </div>
                    <input type="hidden" id="mealType" value="" required />
                </div>

                <div class="form-group mb-2">
                    <label class="label mb-1">å†™çœŸ <span class="text-muted">(ä»»æ„)</span></label>
                    <div class="file-upload-wrapper">
                        <input type="file" id="mealPhoto" accept="image/*" capture="environment" class="file-input" />
                        <div class="file-upload-ui">
                            <span class="upload-icon">ğŸ“·</span>
                            <span>ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸã‚’æ’®å½±ã¾ãŸã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</span>
                        </div>
                    </div>
                    <div id="previewContainer" class="hidden mt-2">
                        <img id="photoPreview" src="" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" class="photo-preview" />
                        <button type="button" id="removePhoto" class="btn-remove-photo">Ã— å†™çœŸã‚’å‰Šé™¤</button>
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="label mb-1">é£Ÿäº‹ã®å†…å®¹ <span class="text-danger">*</span></label>
                    <textarea id="mealText" class="text-area" rows="4"
                        placeholder="ä¾‹: é¶èƒ¸è‚‰ï¼ˆçš®ãªã—ï¼‰150gã€ç™½ç±³200gã€ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼100g"></textarea>
                    <p class="text-muted text-sm mt-1">ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ã€Œçš®ãªã—ã€ã€Œæ²¹å°‘ãªã‚ã€ãªã©å…·ä½“çš„ã«æ›¸ãã¨ã€ã‚ˆã‚Šæ­£ç¢ºã«åˆ†æã§ãã¾ã™ã€‚</p>
                </div>

                <button type="submit" id="analyzeBtn" class="btn btn-primary w-100">
                    AIã§åˆ†æã™ã‚‹ ğŸ¤–
                </button>
            </form>
        </section>

        <!-- Result Section (Hidden initially) -->
        <section id="resultSection" class="card hidden animate-fade-in">
            <h2 class="mb-2">ğŸ§  åˆ†æçµæœ</h2>
            <div id="aiResponse" class="ai-response-box mb-4">
                <!-- AI Content goes here -->
                <div class="loading-spinner">åˆ†æä¸­...</div>
            </div>

            <div class="action-buttons">
                <button id="confirmBtn" class="btn btn-primary w-100 mb-2">è¨˜éŒ²ã‚’ç¢ºå®š</button>
                <button id="retryBtn" class="btn btn-secondary w-100">ç·¨é›† / å†åˆ†æ</button>
            </div>
        </section>
    </main>

    <style>
        .file-upload-wrapper {
            position: relative;
            height: 120px;
            border: 2px dashed #ddd;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fafafa;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .file-upload-wrapper:hover {
            border-color: var(--primary);
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload-ui {
            pointer-events: none;
            color: var(--text-muted);
            font-size: 0.9rem;
            text-align: center;
        }

        .text-area {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: var(--radius-sm);
            font-family: var(--font-main);
            font-size: 1rem;
            resize: vertical;
        }

        .text-area:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.1);
        }

        .w-100 {
            width: 100%;
        }

        .hidden {
            display: none;
        }

        .photo-preview {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: var(--radius-md);
        }

        .ai-response-box {
            background: #f0f7ff;
            padding: 1rem;
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--secondary);
            white-space: pre-wrap;
        }

        .text-sm {
            font-size: 0.85rem;
        }

        .mt-1 {
            margin-top: 0.5rem;
        }

        .mt-2 {
            margin-top: 1rem;
        }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFunctions } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js";
      
      // Firebaseè¨­å®šã¯ scripts/firebase.js ã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™
    </script>
    <script src="/scripts/firebase.js" type="module"></script>
    <script src="/scripts/dify.js" type="module"></script>
    <script src="/scripts/log.js" type="module"></script>
</body>

</html>